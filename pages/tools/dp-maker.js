import{h as t,Fragment as e}from"preact";import{useState as a,useEffect as n}from"preact/hooks";const o=["squircle","circle"];function r(e){return e.userImage||(e.userImage="/me.jpg"),e.colors||(e.colors=["#f9a83d","#b4284d"]),void 0===e.gradientSize&&(e.gradientSize=10),void 0===e.animateGradient&&(e.animateGradient=!0),void 0===e.shape&&(e.shape="squircle"),t("svg",{viewBox:"0,0,400,400",class:"dp",style:"--me-image-size: "+(1-e.gradientSize/100),"data-shape":"squircle"},t("style",{dangerouslySetInnerHTML:{__html:'\n\t\t\t\t\t\t.dp[data-shape="squircle"] #path-to-clip {\n\t\t\t\t\t\t\td: path(\n\t\t\t\t\t\t\t\t"M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.dp[data-shape="circle"] #path-to-clip {\n\t\t\t\t\t\t\td: path(\n\t\t\t\t\t\t\t\t"M 0 200 C 0 90, 90 0, 200 0 S 400 90, 400 200, 310 400 200 400, 0 310, 0 200"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t'}}),t("defs",null,t("linearGradient",{id:"background-gradient",gradientTransform:"rotate(0 .5 .5)"},e.animateGradient?t("animateTransform",{attributeName:"gradientTransform",type:"rotate",from:"0 .5 .5",to:"360 .5 .5",dur:"10s",repeatCount:"indefinite"}):null,e.colors.map(((a,n)=>t("stop",{key:n,offset:100*n/(e.colors.length-1)+"%","stop-color":a})))),t("path",{id:"path-to-clip",d:"M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200"})),t("clipPath",{id:"image-clip-path"},t("use",{href:"#path-to-clip"})),t("use",{href:"#path-to-clip",fill:"url(#background-gradient)"}),t("g",{style:"transform-origin: center; transform: scale(var(--me-image-size));"},t("image",{href:e.thumbUrl,type:"image/jpeg",alt:"",width:"100%",height:"100%"}),t("image",{id:"dp--user-image",href:e.userImage,type:"image/jpeg",alt:"",width:"100%",height:"100%","clip-path":"url(#image-clip-path)",preserveAspectRatio:"xMidYMid slice"})),t("g",{class:"loading-state-mask","clip-path":"url(#image-clip-path)",style:"display: var(--show-image-loading, none);"},t("rect",{x:"0",y:"0",width:"400",height:"400"}),t("text",null,"Loading...")))}let i,l="squircle",s=0;const c=t=>(t.preventDefault(),t.returnValue="Are you sure you want to exit? Your changes are not saved.");function d(){const d=new FileReader,[u,p]=a({src:"/me.jpg",palette:["#f9a83d","#b4284d"]}),[g,m]=a(["#f9a83d","#b4284d"]),[h,y]=a(10),f=()=>{import("https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.mjs").then((t=>{i=new t.default})).catch((t=>{console.log("error while loading colorthief",t)}))};d.addEventListener("load",(t=>{if("string"==typeof t.target.result){document.documentElement.style.setProperty("--show-image-loading","block");const e=document.createElement("img");e.src=t.target.result,e.onload=()=>{const a=i.getPalette(e,2).map((t=>`#${t.map((t=>t.toString(16).padStart(2,"0"))).join("")}`));p({src:t.target.result,palette:a})}}}));const v=g.every((t=>u.palette.includes(t)));document.documentElement.style.setProperty("--show-image-loading","none");const b="/me.jpg"===u.src;return n((()=>{document.getElementById("img-input").addEventListener("click",f,{once:!0}),document.querySelector("main").addEventListener("input",(()=>{window.addEventListener("beforeunload",c)}),{once:!0})}),[]),t(e,null,t("main",null,t("label",{for:"img-input",class:"dp-container"},t(r,{userImage:u.src,colors:g,gradientSize:h,animateGradient:!1}),t("input",{type:"file",id:"img-input",onChange:t=>{const e=t.target.files[0];e&&e.type.startsWith("image/")&&d.readAsDataURL(e)},accept:"image/*",class:"sr-only"})),t("h2",{class:"heading"},"Create Your Own DP"),t("div",{class:"controls"},t("span",{class:"choose-image-hint"},"You can choose your image by clicking/pressing on the image on the left. Until then, the save button will remain disabled. üòÄ",t("br",null),t("br",null),"Your image is not being uploaded to anywhere. Only the basic usage data is being collected for the purpose of analytics."),t("ul",null,t("li",null,t("h5",null,"Shape"),t("div",{class:"shape-input-container"},o.map((e=>t("label",{for:e,class:"shape-input",key:e},t("input",{name:"shape",type:"radio",id:e,class:"sr-only",value:e,checked:l==e,onChange:()=>(t=>{const e=document.querySelector(".dp");l=t,e.setAttribute("data-shape",t)})(e)}),t("span",{class:"shape-input--selector"},e)))))),t("li",null,t("h5",null,"Colors"),t("div",{className:"colors-input-container"},g.map(((e,a)=>t("label",{class:"color-input",key:a},t("input",{type:"color",class:"sr-only",onInput:t=>{((t,e)=>{const a=e.target.value;m(g.map(((e,n)=>n===t?a:e)))})(a,t)},value:e}),t("div",{class:"color-input--selector",style:`background: ${e};`})))),t("div",{style:{marginLeft:"auto"}},v?null:t("button",{onClick:()=>{pa.track({name:"use image palette colors"}),m(u.palette)},title:"Pick colors from image",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />\n  <circle cx="12" cy="13" r="3" />\n</svg>'}}),t("button",{onClick:()=>{const t=new Array(2).fill(void 0).map((t=>{let e="#";for(let t=1;t<=6;t++)e+=Math.floor(16*Math.random()-.01).toString(16);return e}));pa.track({name:"use random colors"}),m(t)},title:"Pick random colors",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />\n  <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />\n</svg>'}})))),t("li",null,t("h5",null,"Fine tune"),t("span",{class:"input-group"},t("label",{for:"gradient-size"},"Gradient size"),t("input",{type:"range",id:"gradient-size",value:h,min:"0",max:"16",onInput:t=>y(parseInt(t.target.value,10))})),t("span",{class:"input-group"},t("label",null,"Gradient angle"),t("input",{type:"range",id:"gradient-angle",value:s,min:"0",max:"360",onInput:t=>(t=>{const e=document.querySelector(".dp");s=t,e.querySelector("#background-gradient").setAttribute("gradientTransform",`rotate(${t} .5 .5)`)})(parseInt(t.target.value,10))}))),t("li",{style:"text-align: right; margin-top: 32px;"},t("button",{class:"save-button",onClick:()=>{window.removeEventListener("beforeunload",c),pa.track({name:"save-dp",unit:`${l} grSize${h} grAngle${s}`});const t=document.querySelector(".dp"),e=2.5*t.clientWidth,a=(new XMLSerializer).serializeToString(t),n=document.createElement("img");n.onload=()=>{const t=document.createElement("canvas"),a=t.getContext("2d"),o=e+100;t.width=o,t.height=o,a.fillStyle=getComputedStyle(document.body).getPropertyValue("--background"),a.fillRect(0,0,o,o),a.drawImage(n,50,50,e,e);const r=t.toDataURL("image/png",1),i=document.createElement("a");i.href=r;const s=new Date;i.download=`dp-${l}-${s.toLocaleDateString("en-GB").split("/").reverse().join("")}-${s.toLocaleTimeString("en-GB",{timeStyle:"short",hour12:!1})}.png`,i.click()};const o=`data:image/svg+xml;base64,${window.btoa(a)}`;n.src=o},disabled:b,title:b?"Why do you want to save my picture? Huh? üòè":null},"Save"))))))}export{d as default};
