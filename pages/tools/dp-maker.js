import{h as e,Fragment as t}from"preact";import{useEffect as a}from"preact/hooks";import{effect as n,signal as o,batch as l}from"@preact/signals";const i=["squircle","circle"];function r(t){let a;void 0===t.userImage&&(t.userImage="/me.jpg"),t.colors||(t.colors=["#f9a83d","#b4284d"]),void 0===t.animateGradient&&(t.animateGradient=!0),void 0===t.shape&&(t.shape="squircle"),void 0===t.gradientSize?a=10:"number"==typeof t.gradientSize?a=t.gradientSize:(a=t.gradientSize.value,n((()=>{a=t.gradientSize.value;const e=document.querySelector(".dp");e&&e.style.setProperty("--me-image-size",(1-a/100).toString())})));let o=Array.isArray(t.colors)?t.colors:t.colors.value;return e("svg",{viewBox:"0,0,400,400",class:"dp",style:"--me-image-size: "+(1-a/100),"data-shape":t.shape||"squircle"},e("style",{dangerouslySetInnerHTML:{__html:'\n\t\t\t\t\t\t.dp[data-shape="squircle"] #path-to-clip {\n\t\t\t\t\t\t\td: path(\n\t\t\t\t\t\t\t\t"M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t.dp[data-shape="circle"] #path-to-clip {\n\t\t\t\t\t\t\td: path(\n\t\t\t\t\t\t\t\t"M 0 200 C 0 90, 90 0, 200 0 S 400 90, 400 200, 310 400 200 400, 0 310, 0 200"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t'}}),e("defs",null,e("linearGradient",{id:"background-gradient",gradientTransform:"rotate(0 .5 .5)"},t.animateGradient?e("animateTransform",{attributeName:"gradientTransform",type:"rotate",from:"0 .5 .5",to:"360 .5 .5",dur:"10s",repeatCount:"indefinite"}):null,o.map(((t,a)=>e("stop",{key:a,offset:100*a/(o.length-1)+"%","stop-color":t})))),e("path",{id:"path-to-clip",d:"M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200"})),e("clipPath",{id:"image-clip-path"},e("use",{href:"#path-to-clip"})),e("use",{href:"#path-to-clip",fill:"url(#background-gradient)"}),e("g",{style:"transform-origin: center; transform: scale(var(--me-image-size));"},e("image",{href:t.thumbUrl,type:"image/jpeg",alt:"",width:"100%",height:"100%"}),e("image",{id:"dp--user-image",href:t.userImage,type:"image/jpeg",alt:"",width:"100%",height:"100%","clip-path":"url(#image-clip-path)",preserveAspectRatio:"xMidYMid slice"})),e("g",{class:"loading-state-mask","clip-path":"url(#image-clip-path)",style:"display: var(--show-image-loading, none);"},e("rect",{x:"0",y:"0",width:"400",height:"400"}),e("text",null,"Loading...")))}let s;const c=e=>(e.preventDefault(),e.returnValue="Are you sure you want to exit? Your changes are not saved."),u=o("/me.jpg"),d=o(["#f9a83d","#b4284d"]),p=o(10),g=o("squircle"),m=o(0),h=o(["#f9a83d","#b4284d"]);function v(){const o=new FileReader;n((()=>{const e=m.value,t=document.querySelector(".dp");t?t.querySelector("#background-gradient").setAttribute("gradientTransform",`rotate(${e} .5 .5)`):console.warn("UI not updated for state change",e)}));const v=()=>{import("https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.mjs").then((e=>{s=new e.default})).catch((e=>{console.log("error while loading colorthief",e)}))};o.addEventListener("load",(e=>{const t=e.target.result;"string"==typeof t&&l((async()=>{document.documentElement.style.setProperty("--show-image-loading","block"),u.value=t;const e=document.createElement("img");e.src=t,await new Promise((t=>{e.onload=()=>{let a;a=s?s.getPalette(e,2):[[12,20,5],[104,82,50]],d.value=a.map((e=>`#${e.map((e=>e.toString(16).padStart(2,"0"))).join("")}`)),document.documentElement.style.setProperty("--show-image-loading","none"),t()}}))}))}));const y=h.value.every((e=>d.value.includes(e)));document.documentElement.style.setProperty("--show-image-loading","none");const f="/me.jpg"===u.value;return a((()=>{document.getElementById("img-input").addEventListener("click",v,{once:!0}),document.querySelector("main").addEventListener("input",(()=>{}),{once:!0})}),[]),e(t,null,e("main",null,e("label",{for:"img-input",class:"dp-container"},e(r,{userImage:u,colors:h,gradientSize:p,animateGradient:!1,shape:g}),e("input",{type:"file",id:"img-input",onChange:e=>{const t=e.target.files[0];t&&t.type.startsWith("image/")&&o.readAsDataURL(t)},accept:"image/*",class:"sr-only"})),e("h2",{class:"heading"},"Create Your Own DP"),e("div",{class:"controls"},e("span",{class:"choose-image-hint"},"You can choose your image by clicking/pressing on the image on the left. Until then, the save button will remain disabled. üòÄ",e("br",null),e("br",null),"Your image is not being uploaded to anywhere. Only the basic usage data is being collected for the purpose of analytics."),e("ul",null,e("li",null,e("h5",null,"Shape"),e("div",{class:"shape-input-container"},i.map((t=>e("label",{for:t,class:"shape-input",key:t},e("input",{name:"shape",type:"radio",id:t,class:"sr-only",value:t,checked:g.value==t,onChange:e=>g.value=e.target.value}),e("span",{class:"shape-input--selector"},t)))))),e("li",null,e("h5",null,"Colors"),e("div",{className:"colors-input-container"},h.value.map(((t,a)=>e("label",{class:"color-input",key:a},e("input",{type:"color",class:"sr-only",onInput:e=>{((e,t)=>{const a=t.target.value;h.value=h.value.map(((t,n)=>n===e?a:t))})(a,e)},value:t}),e("div",{class:"color-input--selector",style:`background: ${t};`})))),e("div",{style:{marginLeft:"auto"}},y?null:e("button",{onClick:()=>{pa.track({name:"use image palette colors"}),h.value=d.value},title:"Pick colors from image",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />\n  <circle cx="12" cy="13" r="3" />\n</svg>'}}),e("button",{onClick:()=>{const e=new Array(2).fill(void 0).map((e=>{let t="#";for(let e=1;e<=6;e++)t+=Math.floor(16*Math.random()-.01).toString(16);return t}));pa.track({name:"use random colors"}),h.value=e},title:"Pick random colors",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />\n  <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />\n</svg>'}})))),e("li",null,e("h5",null,"Fine tune"),e("span",{class:"input-group"},e("label",{for:"gradient-size"},"Gradient size"),e("input",{type:"range",id:"gradient-size",value:p.value,min:"0",max:"16",onInput:e=>{p.value=e.target.valueAsNumber}})),e("span",{class:"input-group"},e("label",null,"Gradient angle"),e("input",{type:"range",id:"gradient-angle",value:m,min:"0",max:"360",onInput:e=>m.value=e.target.valueAsNumber}))),e("li",{style:"text-align: right; margin-top: 32px;"},e("button",{class:"save-button",onClick:()=>{window.removeEventListener("beforeunload",c),pa.track({name:"save-dp",unit:`${g.value} grSize${p} grAngle${m.value}`});const e=document.querySelector(".dp"),t=2.5*e.clientWidth,a=(new XMLSerializer).serializeToString(e),n=document.createElement("img");n.onload=()=>{const e=document.createElement("canvas"),a=e.getContext("2d"),o=t+100;e.width=o,e.height=o,a.fillStyle=getComputedStyle(document.body).getPropertyValue("--background"),a.fillRect(0,0,o,o),a.drawImage(n,50,50,t,t);const l=e.toDataURL("image/png",1),i=document.createElement("a");i.href=l;const r=new Date;i.download=`dp-${g.value}-${r.toLocaleDateString("en-GB").split("/").reverse().join("")}-${r.toLocaleTimeString("en-GB",{timeStyle:"short",hour12:!1})}.png`,i.click()};const o=`data:image/svg+xml;base64,${window.btoa(a)}`;n.src=o},disabled:f,title:f?"Why do you want to save my picture? Huh? üòè":null},"Save"))))))}export{v as default};
