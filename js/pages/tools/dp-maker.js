import{h as e,p as t}from"../../preact-a77c9537.js";import{b as n,s as a,h as l,c as o}from"../../signals-db2e8f41.js";import{C as r,a as i}from"../../icons-920d7934.js";import{D as s,a as u}from"../../dp-e371ddb3.js";let c;const d=e=>(e.preventDefault(),e.returnValue="Are you sure you want to exit? Your changes are not saved."),m=o("/me.jpg"),p=o(["#f9a83d","#b4284d"]),g=o(10),h=o("squircle"),v=o(0),y=o(["#f9a83d","#b4284d"]);function f(){const o=new FileReader;n((()=>{const e=v.value,t=document.querySelector(".dp");t?t.querySelector("#background-gradient").setAttribute("gradientTransform",`rotate(${e} .5 .5)`):console.warn("UI not updated for state change",e)}));const f=()=>{import("https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.mjs").then((e=>{c=new e.default})).catch((e=>{console.log("error while loading colorthief",e)}))};o.addEventListener("load",(e=>{const t=e.target.result;"string"==typeof t&&a((async()=>{document.documentElement.style.setProperty("--show-image-loading","block"),m.value=t;const e=document.createElement("img");e.src=t,await new Promise((t=>{e.onload=()=>{let n;n=c?c.getPalette(e,2):[[12,20,5],[104,82,50]],p.value=n.map((e=>`#${e.map((e=>e.toString(16).padStart(2,"0"))).join("")}`)),document.documentElement.style.setProperty("--show-image-loading","none"),t()}}))}))}));const b=y.value.every((e=>p.value.includes(e)));document.documentElement.style.setProperty("--show-image-loading","none");const w="/me.jpg"===m.value;return l((()=>{document.getElementById("img-input").addEventListener("click",f,{once:!0}),document.querySelector("main").addEventListener("input",(()=>{window.addEventListener("beforeunload",d)}),{once:!0})}),[]),e(t,null,e("main",null,e("label",{for:"img-input",class:"dp-container"},e(s,{userImage:m,colors:y,gradientSize:g,animateGradient:!1,shape:h}),e("input",{type:"file",id:"img-input",onChange:e=>{const t=e.target.files[0];t&&t.type.startsWith("image/")&&o.readAsDataURL(t)},accept:"image/*",class:"sr-only"})),e("h2",{class:"heading"},"Create Your Own DP"),e("div",{class:"controls"},e("span",{class:"choose-image-hint"},"You can choose your image by clicking/pressing on the image on the left. Until then, the save button will remain disabled. üòÄ",e("br",null),e("br",null),"Your image is not being uploaded to anywhere. Only the basic usage data is being collected for the purpose of analytics."),e("ul",null,e("li",null,e("h5",null,"Shape"),e("div",{class:"shape-input-container"},u.map((t=>e("label",{for:t,class:"shape-input",key:t},e("input",{name:"shape",type:"radio",id:t,class:"sr-only",value:t,checked:h.value==t,onChange:e=>h.value=e.target.value}),e("span",{class:"shape-input--selector"},t)))))),e("li",null,e("h5",null,"Colors"),e("div",{className:"colors-input-container"},y.value.map(((t,n)=>e("label",{class:"color-input",key:n},e("input",{type:"color",class:"sr-only",onInput:e=>{((e,t)=>{const n=t.target.value;y.value=y.value.map(((t,a)=>a===e?n:t))})(n,e)},value:t}),e("div",{class:"color-input--selector",style:`background: ${t};`})))),e("div",{style:{marginLeft:"auto"}},b?null:e("button",{onClick:()=>{pa.track({name:"use image palette colors"}),y.value=p.value},title:"Pick colors from image",dangerouslySetInnerHTML:{__html:r}}),e("button",{onClick:()=>{const e=new Array(2).fill(void 0).map((()=>{let e="#";for(let t=1;t<=6;t++)e+=Math.floor(16*Math.random()-.01).toString(16);return e}));pa.track({name:"use random colors"}),y.value=e},title:"Pick random colors",dangerouslySetInnerHTML:{__html:i}})))),e("li",null,e("h5",null,"Fine tune"),e("span",{class:"input-group"},e("label",{for:"gradient-size"},"Gradient size"),e("input",{type:"range",id:"gradient-size",value:g.value,min:"0",max:"16",onInput:e=>{g.value=e.target.valueAsNumber}})),e("span",{class:"input-group"},e("label",null,"Gradient angle"),e("input",{type:"range",id:"gradient-angle",value:v,min:"0",max:"360",onInput:e=>v.value=e.target.valueAsNumber}))),e("li",{style:"text-align: right; margin-top: 32px;"},e("button",{class:"save-button",onClick:()=>{window.removeEventListener("beforeunload",d),pa.track({name:"save-dp",unit:`${h.value} grSize${g} grAngle${v.value}`});const e=document.querySelector(".dp"),t=2.5*e.clientWidth,n=(new XMLSerializer).serializeToString(e),a=document.createElement("img");a.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),l=t+100;e.width=l,e.height=l,n.fillStyle=getComputedStyle(document.body).getPropertyValue("--background"),n.fillRect(0,0,l,l),n.drawImage(a,50,50,t,t);const o=e.toDataURL("image/png",1),r=document.createElement("a");r.href=o;const i=new Date;r.download=`dp-${h.value}-${i.toLocaleDateString("en-GB").split("/").reverse().join("")}-${i.toLocaleTimeString("en-GB",{timeStyle:"short",hour12:!1})}.png`,r.click()};const l=`data:image/svg+xml;base64,${window.btoa(n)}`;a.src=l},disabled:w,title:w?"Why do you want to save my picture? Huh? üòè":null},"Save"))))))}export{f as default};
