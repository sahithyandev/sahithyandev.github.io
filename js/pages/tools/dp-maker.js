import{d as e,y as t,n as a,p as n,k as l,u as o}from"../../signals-c7364ffb.js";const i=["squircle","circle"];function r(a){let n;void 0===a.userImage&&(a.userImage="/me.jpg"),a.colors||(a.colors=["#f9a83d","#b4284d"]),void 0===a.animateGradient&&(a.animateGradient=!0),void 0===a.shape&&(a.shape="squircle"),void 0===a.gradientSize?n=10:"number"==typeof a.gradientSize?n=a.gradientSize:(n=a.gradientSize.value,e((()=>{n=a.gradientSize.value;const e=document.querySelector(".dp");e&&e.style.setProperty("--me-image-size",(1-n/100).toString())})));const l=Array.isArray(a.colors)?a.colors:a.colors.value;return t("svg",{viewBox:"0,0,400,400",class:"dp",style:"--me-image-size: "+(1-n/100),"data-shape":a.shape||"squircle"},t("style",{dangerouslySetInnerHTML:{__html:'.dp[data-shape="squircle"] #path-to-clip{d: path("M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200");}.dp[data-shape="circle"] #path-to-clip{d: path("M 0 200 C 0 90, 90 0, 200 0 S 400 90, 400 200, 310 400 200 400, 0 310, 0 200");}'}}),t("defs",null,t("linearGradient",{id:"background-gradient",gradientTransform:"rotate(0 .5 .5)"},a.animateGradient?t("animateTransform",{attributeName:"gradientTransform",type:"rotate",from:"0 .5 .5",to:"360 .5 .5",dur:"10s",repeatCount:"indefinite"}):null,l.map(((e,a)=>t("stop",{key:a,offset:100*a/(l.length-1)+"%","stop-color":e})))),t("path",{id:"path-to-clip",d:"M 0 200 C 0 0, 0 0, 200 0 S 400 0, 400 200, 400 400 200 400, 0 400, 0 200"})),t("clipPath",{id:"image-clip-path"},t("use",{href:"#path-to-clip"})),t("use",{href:"#path-to-clip",fill:"url(#background-gradient)"}),t("g",{style:"transform-origin: center; transform: scale(var(--me-image-size));"},t("image",{href:a.thumbUrl,type:"image/jpeg",alt:"",width:"100%",height:"100%"}),t("image",{id:"dp--user-image",href:a.userImage,type:"image/jpeg",alt:"",width:"100%",height:"100%","clip-path":"url(#image-clip-path)",preserveAspectRatio:"xMidYMid slice"})),t("g",{class:"loading-state-mask","clip-path":"url(#image-clip-path)",style:"display: var(--show-image-loading, none);"},t("rect",{x:"0",y:"0",width:"400",height:"400"}),t("text",null,"Loading...")))}let s;const c=e=>(e.preventDefault(),e.returnValue="Are you sure you want to exit? Your changes are not saved."),d=o("/me.jpg"),u=o(["#f9a83d","#b4284d"]),p=o(10),g=o("squircle"),m=o(0),h=o(["#f9a83d","#b4284d"]);function v(){const o=new FileReader;e((()=>{const e=m.value,t=document.querySelector(".dp");t?t.querySelector("#background-gradient").setAttribute("gradientTransform",`rotate(${e} .5 .5)`):console.warn("UI not updated for state change",e)}));const v=()=>{import("https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.mjs").then((e=>{s=new e.default})).catch((e=>{console.log("error while loading colorthief",e)}))};o.addEventListener("load",(e=>{const t=e.target.result;"string"==typeof t&&a((async()=>{document.documentElement.style.setProperty("--show-image-loading","block"),d.value=t;const e=document.createElement("img");e.src=t,await new Promise((t=>{e.onload=()=>{let a;a=s?s.getPalette(e,2):[[12,20,5],[104,82,50]],u.value=a.map((e=>`#${e.map((e=>e.toString(16).padStart(2,"0"))).join("")}`)),document.documentElement.style.setProperty("--show-image-loading","none"),t()}}))}))}));const y=h.value.every((e=>u.value.includes(e)));document.documentElement.style.setProperty("--show-image-loading","none");const f="/me.jpg"===d.value;return n((()=>{document.getElementById("img-input").addEventListener("click",v,{once:!0}),document.querySelector("main").addEventListener("input",(()=>{window.addEventListener("beforeunload",c)}),{once:!0})}),[]),t(l,null,t("main",null,t("label",{for:"img-input",class:"dp-container"},t(r,{userImage:d,colors:h,gradientSize:p,animateGradient:!1,shape:g}),t("input",{type:"file",id:"img-input",onChange:e=>{const t=e.target.files[0];t&&t.type.startsWith("image/")&&o.readAsDataURL(t)},accept:"image/*",class:"sr-only"})),t("h2",{class:"heading"},"Create Your Own DP"),t("div",{class:"controls"},t("span",{class:"choose-image-hint"},"You can choose your image by clicking/pressing on the image on the left. Until then, the save button will remain disabled. üòÄ",t("br",null),t("br",null),"Your image is not being uploaded to anywhere. Only the basic usage data is being collected for the purpose of analytics."),t("ul",null,t("li",null,t("h5",null,"Shape"),t("div",{class:"shape-input-container"},i.map((e=>t("label",{for:e,class:"shape-input",key:e},t("input",{name:"shape",type:"radio",id:e,class:"sr-only",value:e,checked:g.value==e,onChange:e=>g.value=e.target.value}),t("span",{class:"shape-input--selector"},e)))))),t("li",null,t("h5",null,"Colors"),t("div",{className:"colors-input-container"},h.value.map(((e,a)=>t("label",{class:"color-input",key:a},t("input",{type:"color",class:"sr-only",onInput:e=>{((e,t)=>{const a=t.target.value;h.value=h.value.map(((t,n)=>n===e?a:t))})(a,e)},value:e}),t("div",{class:"color-input--selector",style:`background: ${e};`})))),t("div",{style:{marginLeft:"auto"}},y?null:t("button",{onClick:()=>{gtag("event","dp__use_palette_colors"),h.value=u.value},title:"Pick colors from image",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />\n  <circle cx="12" cy="13" r="3" />\n</svg>'}}),t("button",{onClick:()=>{const e=new Array(2).fill(void 0).map((()=>{let e="#";for(let t=1;t<=6;t++)e+=Math.floor(16*Math.random()-.01).toString(16);return e}));gtag("event","dp__use_random_colors"),h.value=e},title:"Pick random colors",dangerouslySetInnerHTML:{__html:'<svg class="icon icon-tabler icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />\n  <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />\n</svg>'}})))),t("li",null,t("h5",null,"Fine tune"),t("span",{class:"input-group"},t("label",{for:"gradient-size"},"Gradient size"),t("input",{type:"range",id:"gradient-size",value:p.value,min:"0",max:"16",onInput:e=>{p.value=e.target.valueAsNumber}})),t("span",{class:"input-group"},t("label",null,"Gradient angle"),t("input",{type:"range",id:"gradient-angle",value:m,min:"0",max:"360",onInput:e=>m.value=e.target.valueAsNumber}))),t("li",{style:"text-align: right; margin-top: 32px;"},t("button",{class:"styled-btn",onClick:()=>{window.removeEventListener("beforeunload",c),gtag("event","dp__save",{shape:g.value,gradientSize:p.value,gradientAngle:m.value});const e=document.querySelector(".dp"),t=2.5*e.clientWidth,a=(new XMLSerializer).serializeToString(e),n=document.createElement("img");n.onload=()=>{const e=document.createElement("canvas"),a=e.getContext("2d"),l=t+100;e.width=l,e.height=l,a.fillStyle=getComputedStyle(document.body).getPropertyValue("--background"),a.fillRect(0,0,l,l),a.drawImage(n,50,50,t,t);const o=e.toDataURL("image/png",1),i=document.createElement("a");i.href=o;const r=new Date;i.download=`dp-${g.value}-${r.toLocaleDateString("en-GB").split("/").reverse().join("")}-${r.toLocaleTimeString("en-GB",{timeStyle:"short",hour12:!1})}.png`,i.click()};const l=`data:image/svg+xml;base64,${window.btoa(a)}`;n.src=l},disabled:f,title:f?"Why do you want to save my picture? Huh? üòè":null},"Save"))))))}export{v as default};
